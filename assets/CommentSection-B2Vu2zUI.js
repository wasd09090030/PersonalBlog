import{_ as j,r as i,o as D,b as a,j as n,d as t,n as k,t as r,e as p,g as c,B as N,C as y,D as g,F as V,h as $}from"./index-BvN9veIB.js";const q={class:"comment-section mt-5 animate__animated animate__fadeInUp"},B={class:"like-section mb-4 text-center"},O=["disabled"],P={class:"like-count ms-2"},U={class:"like-text ms-1"},M={class:"comment-form card mb-4"},z={class:"card-body"},F={key:0,class:"alert alert-success animate__animated animate__fadeIn"},A={class:"row mb-3"},E={class:"col-md-6"},J={class:"col-md-6"},G={class:"mb-3"},H={class:"form-text"},K=["disabled"],Q={key:0,class:"spinner-border spinner-border-sm me-2"},R={class:"comments-list"},W={class:"mb-4"},X={key:0,class:"text-center py-4"},Y={key:1,class:"text-muted text-center py-4"},Z={key:2},tt={class:"card-body"},et={class:"d-flex justify-content-between align-items-start mb-2"},st={class:"comment-author"},ot={class:"author-name"},at={class:"text-muted ms-2"},nt={key:0,class:"ms-2"},lt=["href"],it=["onClick"],rt={key:0,class:"ms-1"},ct={class:"comment-content"},dt={__name:"CommentSection",props:{articleId:{type:Number,required:!0}},setup(w){const m=w,h=i([]),_=i(0),d=i(!1),v=i(!1),u=i(!1),b=i(!1),f=i(!0),l=i({author:"",email:"",content:""}),x=async()=>{try{f.value=!0;const s=await fetch(`http://localhost:3000/comments/article/${m.articleId}`);s.ok&&(h.value=await s.json())}catch(s){console.error("获取评论失败:",s)}finally{f.value=!1}},C=async()=>{try{const s=await fetch(`http://localhost:3000/likes/article/${m.articleId}/status`);if(s.ok){const e=await s.json();_.value=e.count,d.value=e.isLiked}}catch(s){console.error("获取点赞状态失败:",s)}},I=async()=>{if(!v.value){v.value=!0;try{const s=await fetch(`http://localhost:3000/likes/article/${m.articleId}`,{method:"POST",headers:{"Content-Type":"application/json"}});if(s.ok){const e=await s.json();_.value=e.count,d.value=e.liked}}catch(s){console.error("点赞操作失败:",s)}finally{v.value=!1}}},S=async()=>{if(!u.value){u.value=!0,b.value=!1;try{(await fetch("http://localhost:3000/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...l.value,articleId:m.articleId})})).ok&&(l.value={author:"",email:"",content:""},b.value=!0,setTimeout(()=>{b.value=!1},3e3))}catch(s){console.error("提交评论失败:",s)}finally{u.value=!1}}},L=async s=>{try{(await fetch(`http://localhost:3000/comments/${s}/like`,{method:"POST"})).ok&&await x()}catch(e){console.error("点赞评论失败:",e)}},T=s=>new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return D(()=>{x(),C()}),(s,e)=>(n(),a("div",q,[t("div",B,[t("button",{onClick:I,class:k(["btn","like-btn",{liked:d.value}]),disabled:v.value},[t("i",{class:k(["bi",d.value?"bi-heart-fill":"bi-heart"])},null,2),t("span",P,r(_.value),1),t("span",U,r(d.value?"已点赞":"点赞"),1)],10,O)]),t("div",M,[t("div",z,[e[6]||(e[6]=t("h5",{class:"card-title"},[t("i",{class:"bi bi-chat-dots me-2"}),c(" 发表评论 ")],-1)),b.value?(n(),a("div",F,e[3]||(e[3]=[t("i",{class:"bi bi-check-circle me-2"},null,-1),c(" 评论提交成功！正在等待审核... ")]))):p("",!0),e[7]||(e[7]=c()),t("form",{onSubmit:N(S,["prevent"])},[t("div",A,[t("div",E,[y(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>l.value.author=o),type:"text",class:"form-control",placeholder:"姓名 *",required:"",maxlength:"50"},null,512),[[g,l.value.author]])]),t("div",J,[y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=o=>l.value.email=o),type:"email",class:"form-control",placeholder:"邮箱（可选）",maxlength:"100"},null,512),[[g,l.value.email]])])]),t("div",G,[y(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=o=>l.value.content=o),class:"form-control",rows:"4",placeholder:"写下您的评论... *",required:"",maxlength:"1000"},null,512),[[g,l.value.content]]),t("div",H,r(l.value.content.length)+"/1000",1)]),t("button",{type:"submit",class:"btn btn-primary",disabled:u.value},[u.value?(n(),a("span",Q)):p("",!0),e[4]||(e[4]=t("i",{class:"bi bi-send me-2"},null,-1)),e[5]||(e[5]=c(" 发表评论 "))],8,K)],32)])]),t("div",R,[t("h5",W,[e[8]||(e[8]=t("i",{class:"bi bi-chat-left-text me-2"},null,-1)),c(" 评论 ("+r(h.value.length)+") ",1)]),f.value?(n(),a("div",X,e[9]||(e[9]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"加载中...")],-1)]))):h.value.length===0?(n(),a("div",Y,e[10]||(e[10]=[t("i",{class:"bi bi-chat-square-dots fs-1 mb-3 d-block"},null,-1),c(" 暂无评论，来发表第一条评论吧！ ")]))):(n(),a("div",Z,[(n(!0),a(V,null,$(h.value,o=>(n(),a("div",{key:o.id,class:"comment-item card mb-3 animate__animated animate__fadeInLeft"},[t("div",tt,[t("div",et,[t("div",st,[t("strong",ot,[e[11]||(e[11]=t("i",{class:"bi bi-person-circle me-1"},null,-1)),c(" "+r(o.author),1)]),t("small",at,r(T(o.createdAt)),1),o.website?(n(),a("span",nt,[t("a",{href:o.website,target:"_blank",class:"text-decoration-none"},e[12]||(e[12]=[t("i",{class:"bi bi-link-45deg"},null,-1)]),8,lt)])):p("",!0)]),t("button",{onClick:ut=>L(o.id),class:k(["btn btn-sm btn-outline-danger comment-like-btn",{active:o.isLiked}])},[e[13]||(e[13]=t("i",{class:"bi bi-heart"},null,-1)),o.likes>0?(n(),a("span",rt,r(o.likes),1)):p("",!0)],10,it)]),t("div",ct,r(o.content),1)])]))),128))]))])]))}},ht=j(dt,[["__scopeId","data-v-f9791c88"]]);export{ht as default};
