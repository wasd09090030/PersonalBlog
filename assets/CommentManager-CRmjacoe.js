import{_ as M,r as b,c as D,w as T,o as S,b as n,d as t,e as d,n as k,g as a,t as i,F as B,h as N,B as E,j as o}from"./index-BvN9veIB.js";const I={class:"comment-manager"},L={class:"d-flex justify-content-between align-items-center mb-4"},V={class:"btn-group",role:"group"},z={class:"badge bg-warning ms-1"},A={key:0,class:"text-center py-5"},F={key:1},P={key:0,class:"text-center py-5 text-muted"},q={key:1,class:"row"},H={class:"card comment-card"},J={class:"card-body"},O={class:"row"},G={class:"col-md-8"},K={class:"comment-info"},Q={class:"card-title mb-2"},R={class:"card-text mb-2"},U={class:"comment-meta"},W={class:"text-muted"},X={key:0,class:"text-muted ms-3"},Y={key:1,class:"text-muted ms-3"},Z=["href"],ss={key:2,class:"text-muted ms-3"},ts={key:0,class:"article-info mt-2"},es={class:"text-primary"},ls={class:"col-md-4"},ns={class:"comment-actions d-flex flex-column gap-2"},os={key:0,class:"btn-group"},as=["onClick","disabled"],is=["onClick","disabled"],ds={key:1,class:"btn-group"},rs=["onClick","disabled"],us=["onClick","disabled"],cs=["onClick","disabled"],bs={class:"like-info text-center mt-2"},vs={class:"text-muted"},ps={class:"modal-content"},ms={class:"modal-header"},gs={class:"modal-body"},ys={key:0,class:"alert alert-light"},_s={class:"modal-footer"},fs=["disabled"],ks={key:0,class:"spinner-border spinner-border-sm me-2"},hs={__name:"CommentManager",setup(Cs){const p=b([]),f=b(!0),r=b(!1),m=b(!1),u=b("pending"),c=b(null),v=b(!1),h=D(()=>p.value.filter(l=>l.status==="pending").length),g=async()=>{f.value=!0;try{const l=u.value==="pending"?"http://localhost:3000/comments/admin/pending":"http://localhost:3000/comments/admin/all",s=await fetch(l);s.ok&&(p.value=await s.json())}catch(l){console.error("获取评论失败:",l)}finally{f.value=!1}},y=async(l,s)=>{r.value=!0;try{(await fetch(`http://localhost:3000/comments/admin/${l}/status`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s})})).ok&&await g()}catch(e){console.error("更新评论状态失败:",e)}finally{r.value=!1}},C=l=>{c.value=l,v.value=!0},x=async()=>{if(c.value){m.value=!0;try{(await fetch(`http://localhost:3000/comments/admin/${c.value.id}`,{method:"DELETE"})).ok&&(v.value=!1,c.value=null,await g())}catch(l){console.error("删除评论失败:",l)}finally{m.value=!1}}},w=l=>({pending:"bg-warning",approved:"bg-success",rejected:"bg-danger"})[l]||"bg-secondary",$=l=>({pending:"待审核",approved:"已通过",rejected:"已拒绝"})[l]||"未知",j=l=>new Date(l).toLocaleString("zh-CN");return T(u,()=>{g()}),S(()=>{g()}),(l,s)=>(o(),n("div",I,[t("div",L,[s[7]||(s[7]=t("h2",null,"评论管理",-1)),t("div",V,[t("button",{type:"button",class:k(["btn btn-outline-primary",{active:u.value==="pending"}]),onClick:s[0]||(s[0]=e=>u.value="pending")},[s[6]||(s[6]=a(" 待审核 ")),t("span",z,i(h.value),1)],2),t("button",{type:"button",class:k(["btn btn-outline-primary",{active:u.value==="all"}]),onClick:s[1]||(s[1]=e=>u.value="all")}," 全部评论 ",2)])]),f.value?(o(),n("div",A,s[8]||(s[8]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"加载中...")],-1)]))):(o(),n("div",F,[p.value.length===0?(o(),n("div",P,[s[9]||(s[9]=t("i",{class:"bi bi-chat-square-dots fs-1 mb-3"},null,-1)),t("p",null,i(u.value==="pending"?"暂无待审核评论":"暂无评论"),1)])):(o(),n("div",q,[(o(!0),n(B,null,N(p.value,e=>(o(),n("div",{key:e.id,class:"col-12 mb-3"},[t("div",H,[t("div",J,[t("div",O,[t("div",G,[t("div",K,[t("h6",Q,[s[10]||(s[10]=t("i",{class:"bi bi-person-circle me-2"},null,-1)),a(" "+i(e.author)+" ",1),t("span",{class:k(["badge ms-2",w(e.status)])},i($(e.status)),3)]),t("p",R,i(e.content),1),t("div",U,[t("small",W,[s[11]||(s[11]=t("i",{class:"bi bi-calendar3 me-1"},null,-1)),a(" "+i(j(e.createdAt)),1)]),e.email?(o(),n("small",X,[s[12]||(s[12]=t("i",{class:"bi bi-envelope me-1"},null,-1)),a(" "+i(e.email),1)])):d("",!0),e.website?(o(),n("small",Y,[s[13]||(s[13]=t("i",{class:"bi bi-link-45deg me-1"},null,-1)),t("a",{href:e.website,target:"_blank",class:"text-decoration-none"},i(e.website),9,Z)])):d("",!0),e.userIp?(o(),n("small",ss,[s[14]||(s[14]=t("i",{class:"bi bi-geo-alt me-1"},null,-1)),a(" IP: "+i(e.userIp),1)])):d("",!0)]),e.article?(o(),n("div",ts,[t("small",es,[s[15]||(s[15]=t("i",{class:"bi bi-file-text me-1"},null,-1)),a(" 文章: "+i(e.article.title),1)])])):d("",!0)])]),t("div",ls,[t("div",ns,[e.status==="pending"?(o(),n("div",os,[t("button",{class:"btn btn-success btn-sm",onClick:_=>y(e.id,"approved"),disabled:r.value},s[16]||(s[16]=[t("i",{class:"bi bi-check-circle me-1"},null,-1),a(" 通过 ")]),8,as),t("button",{class:"btn btn-warning btn-sm",onClick:_=>y(e.id,"rejected"),disabled:r.value},s[17]||(s[17]=[t("i",{class:"bi bi-x-circle me-1"},null,-1),a(" 拒绝 ")]),8,is)])):(o(),n("div",ds,[e.status==="approved"?(o(),n("button",{key:0,class:"btn btn-warning btn-sm",onClick:_=>y(e.id,"rejected"),disabled:r.value},s[18]||(s[18]=[t("i",{class:"bi bi-eye-slash me-1"},null,-1),a(" 隐藏 ")]),8,rs)):d("",!0),e.status==="rejected"?(o(),n("button",{key:1,class:"btn btn-success btn-sm",onClick:_=>y(e.id,"approved"),disabled:r.value},s[19]||(s[19]=[t("i",{class:"bi bi-eye me-1"},null,-1),a(" 显示 ")]),8,us)):d("",!0)])),t("button",{class:"btn btn-danger btn-sm",onClick:_=>C(e),disabled:r.value},s[20]||(s[20]=[t("i",{class:"bi bi-trash me-1"},null,-1),a(" 删除 ")]),8,cs),t("div",bs,[t("small",vs,[s[21]||(s[21]=t("i",{class:"bi bi-heart-fill text-danger me-1"},null,-1)),a(" "+i(e.likes)+" 个赞 ",1)])])])])])])])]))),128))]))])),v.value?(o(),n("div",{key:2,class:"modal-overlay",onClick:s[5]||(s[5]=e=>v.value=!1)},[t("div",{class:"modal-dialog",onClick:s[4]||(s[4]=E(()=>{},["stop"]))},[t("div",ps,[t("div",ms,[s[22]||(s[22]=t("h5",{class:"modal-title"},"确认删除",-1)),t("button",{type:"button",class:"btn-close",onClick:s[2]||(s[2]=e=>v.value=!1)},"×")]),t("div",gs,[s[23]||(s[23]=t("p",null,"确定要删除这条评论吗？此操作不可撤销。",-1)),c.value?(o(),n("div",ys,[t("strong",null,i(c.value.author),1),a(": "+i(c.value.content),1)])):d("",!0)]),t("div",_s,[t("button",{type:"button",class:"btn btn-secondary",onClick:s[3]||(s[3]=e=>v.value=!1)},"取消"),t("button",{type:"button",class:"btn btn-danger",onClick:x,disabled:m.value},[m.value?(o(),n("span",ks)):d("",!0),s[24]||(s[24]=a(" 确认删除 "))],8,fs)])])])])):d("",!0)]))}},ws=M(hs,[["__scopeId","data-v-f022a7b1"]]);export{ws as default};
